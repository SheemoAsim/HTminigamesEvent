<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üß† Memory Test</title>

<body style= "background: transparent;">
<style>
  * { box-sizing: border-box; font-family: 'Arial', sans-serif; }

  body {
    margin: 0;

    color: #fff;
    text-align: center;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }

  h1 { margin-top: 10px; font-size: 1.8em; }

  .screen { display: none; max-width: 500px; margin-top: 0; }
  .active { display: block; }

  button {
    background: #fff; color: #764ba2;
    padding: 12px 25px; margin: 10px;
    font-size: 1em; border: none; border-radius: 10px;
    cursor: pointer; transition: 0.3s;
  }
  button:hover { background: #f0f0f0; }

  .item-grid, .choice-grid {
    display: grid;
    gap: 15px;
    margin: 10px 0;
  }

  .item-grid { grid-template-columns: repeat(3, 1fr); }
  .choice-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px;
  }

  .item {
    background: #fff;
    border-radius: 12px;
    padding: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
  }
 
  .item img {
    max-width: 90%;
    max-height: 100px;
    object-fit: contain;
  }

  .choices img {
    max-width: 80%;
    max-height: 90px;
    object-fit: contain;
  }


  .question { margin: 10px 0; font-size: 1.2em; }
  .info { 
  display:flex; justify-content:space-between; align-items:center; 
  gap:10px; font-size:1.1em; padding:0; 
width:300px; margin:0 ; 
}

  /* Popup */
  #tutorialPopup, #endScreen {
    width: min(90vw, 340px);
    background: #fff; color: #333; border-radius: 14px;
    padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    text-align: center;
z-index:1000;
  }

  

  #tutorialPopup button, #endScreen button {
    font-size: 1em;
    padding: 10px 20px;
    margin-top: 15px;
    background: #6E0010;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #tutorialPopup button:hover, #endScreen button:hover { background: #5a379d; }

.overlay {  position: fixed;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.6);
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  color:white; font-size:1.2em; padding:20px; text-align:center; z-index:400;}

  .hidden { display: none !important; }

.info { 
  display:flex;  
  gap:15px; font-size:1.1em; padding:0; 
background:rgba(255,255,255,0.08); 
  border-radius:10px; width:350px; height: 30px; margin:0 auto; 
 justify-content: center;
align-items:center;
}
</style>
</head>
<body>

<h1 style= "margin-bottom:10px;">üß† Items Memory Test</h1>

<div class="info">
    <p style:"margin-right: 10px;">üèÜ High Score: <span id="highScoreText">0</span>|</p>
<p>Score: <span id="score">0</span></p>|
<div id="hud">Lives: <span id="attempts">3</span></div>

</div>

<!-- Show Items Screen -->
<div id="showScreen" class="screen">
  <p>‚ú® Memorize these items!</p>
  <div id="items" class="item-grid"></div>
</div>

<!-- Question Screen -->
<div id="questionScreen" class="screen">

  <p class="question">ü§î Which of these items was shown?</p>
  <div id="choices" class="choice-grid"></div>
  
</div>

<!-- Game Over Popup -->
<div id="endScreen" class="hidden">
  <h2> Game Over! üò¢</h2>
  <p>‚úÖ Your Score: <span id="finalScore">0</span></p>
  <p>üèÜ High Score: <span id="finalHighScore">0</span></p>
  <button onclick="resetGame()"> Play Again</button>
        <div class="retry-left"style="color: grey !important;" id="retryLeft"></div>
</div>

</div>
  <div class="overlay" id="overlay"></div>
</div>

<!-- Tutorial Popup -->
<div id="tutorialPopup" class="hidden">
  <h3>Tutorials</h3>
  <p>Welcome to <strong>üß† Items Memory Test</strong>!</p>
  <p>1- Memorize the shown items quickly.</p>
  <p>2- Choose the <strong>correct item</strong> from 4 options.</p>
  <p>3- You only have <strong>3 mistakes</strong> for each level ‚Äî be careful!</p>
  <p>Good luck, and have fun! üéâ</p>
  
  <button onclick="resetGame()">‚ñ∂Ô∏è Play</button>
</div>

  <button style="background: transparent; padding:2px; font-size:1.5em; "id="retryBtn" onclick="resetGame()">üîÑ</button>
           <div class="retry-left"id="retryLeft"></div>




<script>

let retries = 0;
const maxRetries = 2; // ‚úÖ internally 2 (first + one retry)
let attempts = 3; // ‚úÖ 3 lives

const allItems = [
  "Rose.png","Milk.png","Corn.png","Cherry.png","Gold_Necklace.png","Collar.png","Meal_for_students.png","Ice_Cream.png","Yogurt.png",
  "Peacock_Feather.png","Rural_Dog.png","Sapphire.png",
  "ErSilver_Bucket.png","Darkgold_Ore.png","Bike.png",
  "ErLimit_Pack.png","Cheese_Cake.png","ErKetchup_Chip.png","Small_Bomb.png","Ginseng.png","Tuna_sandwich.png","Gold_Ingot.png",
];

let shownItems = [], score = 0;

const scoreEl = document.getElementById("score");
const highScoreText = document.getElementById("highScoreText");
const finalScore = document.getElementById("finalScore");
const finalHighScore = document.getElementById("finalHighScore");
const attemptsEl = document.getElementById("attempts"); 
const retryLeftEls = document.getElementsByClassName('retry-left');
const gameContainer = document.getElementById("gameContainer");

// ---------- Preload Images ----------
function preloadGameImages(callback) {
  let loadedCount = 0;
  allItems.forEach(src => {
    const img = new Image();
    img.src = src;
    if (img.complete) loadedCount++;
    else img.onload = img.onerror = () => { loadedCount++; if (loadedCount >= allItems.length) done(); };
  });

  function done() {
    console.log("‚úÖ Memory Test images preloaded!");
    window.parent.postMessage("loaded", "*"); // notify parent
    callback();
  }

  if (loadedCount >= allItems.length) done();
}


function startGame() {
  score = 0;
  attempts = 3; 
  attemptsEl.textContent = attempts;
  scoreEl.textContent = score;
  hidePopups();
  showScreen("showScreen");
  generateItems();
}

function generateItems() {
  const itemsDiv = document.getElementById("items");
  itemsDiv.innerHTML = '';

  const shuffled = [...allItems].sort(() => Math.random() - 0.5);
  shownItems = shuffled.slice(0, 9);

  shownItems.forEach(item => {
    const div = document.createElement("div");
    div.className = 'item';
    div.innerHTML = `<img src="${item}" alt="${item}">`;
    itemsDiv.appendChild(div);
  });

  setTimeout(() => { askQuestion(); }, 3000);
}

function askQuestion() {
  showScreen("questionScreen");
  const choicesDiv = document.getElementById("choices");
  choicesDiv.innerHTML = '';

  const correctItem = shownItems[Math.floor(Math.random() * shownItems.length)];
  const wrongItems = allItems.filter(i => !shownItems.includes(i));
  const shuffledWrongs = wrongItems.sort(() => Math.random() - 0.5).slice(0, 3);
  const options = [correctItem, ...shuffledWrongs].sort(() => Math.random() - 0.5);

  options.forEach(opt => {
    const div = document.createElement("div");
    div.className = 'item';
    div.innerHTML = `<img src="${opt}" alt="${opt}">`;

    div.onclick = () => {
      if (opt === correctItem) {
        div.style.background = "lightgreen"; 
        setTimeout(() => {
          score++;
          scoreEl.textContent = score;
          showScreen("showScreen");
          generateItems();
        }, 800);
      } else {
        div.style.background = "lightcoral"; 
        setTimeout(() => {
          attempts--; 
          attemptsEl.textContent = attempts;
          if (attempts <= 0) {
            endGame();
          } else {
            showScreen("showScreen");
            generateItems();
          }
        }, 800);
      }
    };

    choicesDiv.appendChild(div);
  });
}

function endGame() {
  finalScore.textContent = score;
  let best = parseInt(localStorage.getItem("memoryHighScore")) || 0;

  if (score > best) {
    localStorage.setItem("memoryHighScore", score);
    best = score;
  }

  finalHighScore.textContent = best;
  highScoreText.textContent = best; // ‚úÖ Update HUD high score too

  window.parent.postMessage({ 
    type: "highscore", 
    game: 1,  
    highscore: best 
  }, "*");

  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById("endScreen").classList.remove("hidden");
  document.getElementById('overlay').classList.remove('hidden');
}



  

  



function resetGame() {
  if (retries >= maxRetries) {
    // this retry is the second & final
    alert("No retries left!");
document.getElementById("endScreen").classList.add("hidden");
    retries++;
    updateRetryLeft();
    disableGame();
    return;
  }
  document.getElementById("endScreen").classList.add("hidden");
  document.getElementById('overlay').classList.add('hidden');
  startGame();

  retries++;
  updateRetryLeft();
}


function updateRetryLeft() {
    // total retries display = maxRetries - 1 (first play doesn't reduce display)
    let displayTotal = maxRetries - 1;

    // display retries: first play doesn't reduce display, but clamp to 0 minimum
    let displayRetries = Math.max(0, displayTotal - Math.max(0, retries - 1));

    // update all elements in retryLeftEls
    Array.from(retryLeftEls).forEach(el => {
        el.textContent = `Retries left: ${displayRetries}/${displayTotal}`;
    });

    // save current retries
    localStorage.setItem("memoryRetries", retries);
}



function disableGame() {
  gameContainer.style.pointerEvents = "none";
  gameContainer.style.opacity = "0.5";
}


function showScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function updateHighScore() {
  const saved = localStorage.getItem("memoryHighScore") || 0;
  highScoreText.textContent = saved;
}

function showTutorial(){
  document.getElementById("tutorialPopup").classList.remove("hidden");
  document.getElementById('overlay').classList.remove('hidden');
}

function hidePopups(){
  document.getElementById("endScreen").classList.add("hidden");
  document.getElementById("tutorialPopup").classList.add("hidden");
  document.getElementById('overlay').classList.add('hidden');
}

updateHighScore();

window.onload = () => { 
  const savedRetries = parseInt(localStorage.getItem("memoryRetries"));
  if (!isNaN(savedRetries)) {
    retries = savedRetries;
  }
  if (retries >= maxRetries) disableGame();
  showTutorial();
  updateRetryLeft();
};

</script>


</body>
</html>
