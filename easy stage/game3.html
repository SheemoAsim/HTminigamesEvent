<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guess the NPC 🧐</title>
<link href="style.css" rel="stylesheet">
</head>
<body style="background: transparent; margin:0; padding:0; overflow:hidden;">
  <div class="page" id="page4" style="display:flex; flex-direction:column; padding:10px; margin:0; ">

  <h2 style="margin:10px;">Guess the NPC 🧐</h2>


  <!-- Score & Quizzes Info -->
  <div class="score-info" style="display:flex; justify-content:space-between; margin-bottom:10px;">
      <div id="quizLeft3">Quizzes left: <strong id="quizzesLeft">6</strong></div>
      <div id="score3">Score: 0/6</div>
  </div>

  <!-- Timer -->
  <div class="timer-container">
      <div class="timer-bar-bg">
          <div id="timerBar3" class="timer-bar-fill"></div>
      </div>
      <div class="timer-seconds" id="timerSec3">30s</div>
  </div>

  <!-- Game Container -->
  <div style="padding:10px;margin:10px"class="game-container">
      <div style="height:380px;margin-bottom:0;" class="game-box" id="gameBox3">
          <div id="gameContainer">
              <div class="emoji" id="question"></div>
              <div class="options" id="options"></div>
          </div>

      </div>

<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; ">
  <button style="margin:10px !important; " id="retry" onclick="resetGame3()">🔄</button>
  <div class="retry-left" id="retryLeft3"></div>
</div>


</div>
  <div class="overlay" id="overlay"></div>
</div>

      <!-- Disabled Overlay -->

              
          <div style="width:100px;"></div>
      </div>
  </div>


  <!-- Tutorial Popup -->
  <div class="popup" id="tutorial3">
 <h3>Tutorial</h3>
  <p>Welcome to <strong>Guess the NPC 🧐</strong>!</p>
  <p>1- You have 6 Emojis questions!.</p>
  <p>2- Tap the NPC name that matches the emojis.</p>
  <p>3-You have 30 seconds for each question.</p>
<p>Good luck, and have fun! 🎉</p>
      <div style="display:flex; gap:8px; justify-content:center;">
          <button class="close" onclick="resetGame3()">▶️ Play</button>




<p style="color:white; justify-content:center;"> <span id="finalScore3"></span></p>
      </div>
  </div>



  <!-- Game Over Popup -->
  <div class="popup" id="gameOver3" style="display:none;justify-content:center;align-items: center;">
      <h3>🎉 Congratulations!</h3>
      <p id="result3">You answered 0/6 correctly</p>
      <p>High Score: <span id="finalHigh3">0/6</span></p>
      <div style="display:flex; gap:8px; justify-content:center; margin-top:10px;">
 
          <button style="justify-content:center;position:relative;"onclick="resetGame3()">Play Again</button>

      </div>
 <div class="retry-left"style="color: grey !important;" id="retryLeft3"></div>
  </div>
</div>

<!-- Developer Reset Button -->


<script>


const game3Questions = [
  { emoji: "🌊🧜‍♂️😒", options: ["Fisher", "Sam", "Glen Cruz", "Chris Ford"], answer: "Fisher" },
  { emoji: "🧗‍♂️💵🧑‍🦳", options: ["John Gray", "Duke Evans", "Chris Ford", "Adam Ford"], answer: "Chris Ford" },
  { emoji: "🎩🐸🏢", options: ["Sam", "Ello", "Abu", "Lee Wah"], answer: "Abu" },
  { emoji: "🐓👨‍🌾🌾", options: ["Gary Cruz", "John Gray", "Bill Hanks", "Peter Allen"], answer: "Gary Cruz" },
  { emoji: "🧑‍💻👓🥡", options: ["Justin Ortiz", "Lee Yeung", "Lee Yau", "Pong Ching"], answer: "Lee Yeung" },
  { emoji: "🪶👩🏻‍🦳🌳", options: ["Foxy", "Ello", "Stone", "Miu"], answer: "Miu" }
];

let game3CurrentIndex = 0;
let game3Score = 0;
let game3Timer = null;
let game3TimeLeft = 30;
let game3Retries = 0;
const game3MaxRetries = 2;
let game3HighScore = 0;

/* Elements */
const game3QuestionElem = document.getElementById("question");
const game3OptionsElem = document.getElementById("options");
const game3TimerElem = document.getElementById("timerBar3");
const game3TimerSecElem = document.getElementById("timerSec3");
const game3ScoreElem = document.getElementById("score3");
const game3QuizLeftElem = document.getElementById("quizzesLeft");
const game3GameOverPopup = document.getElementById("gameOver3");
const game3ResultElem = document.getElementById("result3");
const game3FinalScoreElem = document.getElementById("finalScore3");
const game3FinalHighElem = document.getElementById("finalHigh3");


function updateGame3RetryLeft() {
  // Save retries to localStorage
  localStorage.setItem("game3Retries", game3Retries);

  const displayTotal = game3MaxRetries - 1; // 2-1 = 1
  const displayRetries = displayTotal - Math.max(0, game3Retries - 1); // don't decrease until first retry

  // Update all retry display elements
  const retryLeftElems = document.getElementsByClassName('retry-left');
  Array.from(retryLeftElems).forEach(el => {
    el.textContent = `Retry Left: ${displayRetries}/${displayTotal}`;
  });

  // Disable game if retries reach max
  if (game3Retries >= game3MaxRetries) {
    game3QuestionElem.style.display = "none";
    game3OptionsElem.style.display = "none";
    document.getElementById("tutorial3").style.display = "none";
    document.getElementById('overlay').classList.remove('hidden');
  } else {
    game3QuestionElem.style.display = "block";
    game3OptionsElem.style.display = "block";
    document.getElementById('overlay').classList.add('hidden');
  }
}




/* ✅ Start Game (Play button only, no retries) */
function startGame3() {
  clearInterval(game3Timer);
  game3CurrentIndex = 0;
  game3Score = 0;
  updateGame3Score();
  updateGame3QuizLeft();
  hideGame3Over();
  loadGame3Question();
  document.getElementById("tutorial3").style.display="none";
  document.getElementById('overlay').classList.add('hidden');
  document.getElementById("question").style.display = "block";
  document.getElementById("options").style.display = "block";
}

/* ✅ Reset Game (Retry buttons, consumes retry) */
function resetGame3() {
  if (game3Retries >= game3MaxRetries) {
    alert("No retries left!");
hideGame3Over();
    return;
  }
  game3Retries++;
  updateGame3RetryLeft();
  startGame3();
}

/* Timer per question */
function startGame3Timer() {
  clearInterval(game3Timer);
  game3TimeLeft = 30;
  game3TimerElem.style.width = "100%";
  game3TimerSecElem.textContent = `${game3TimeLeft}s`;

  game3Timer = setInterval(() => {
    game3TimeLeft--;
    const percent = (game3TimeLeft / 30) * 100;
    game3TimerElem.style.width = percent + "%";
    game3TimerSecElem.textContent = `${game3TimeLeft}s`;

    if (game3TimeLeft <= 0) {
      clearInterval(game3Timer);
      endGame3();  
    }
  }, 1000);
}

function loadGame3Question() {
  if (game3CurrentIndex >= game3Questions.length) {
    endGame3();
    return;
  }

  const q = game3Questions[game3CurrentIndex];
  game3QuestionElem.textContent = q.emoji;
  game3OptionsElem.innerHTML = "";
  q.options.forEach(opt => {
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.className = "option-btn";
    btn.onclick = () => checkGame3Answer(opt, btn);
    game3OptionsElem.appendChild(btn);
  });

  startGame3Timer();
}

/* ✅ Only clicked button changes color */
function checkGame3Answer(selected, clickedBtn) {
  const correct = game3Questions[game3CurrentIndex].answer;

  if (selected === correct) {
    clickedBtn.style.backgroundColor = "green";
    clickedBtn.style.color = "white";
    game3Score++;
    updateGame3Score();
  } else {
    clickedBtn.style.backgroundColor = "red";
    clickedBtn.style.color = "white";
  }

  clearInterval(game3Timer);
  disableGame3Buttons();

  setTimeout(nextGame3Question, 800);
}

function disableGame3Buttons() {
  const buttons = game3OptionsElem.querySelectorAll("button");
  buttons.forEach(btn => btn.disabled = true);
}

function nextGame3Question() {
  game3CurrentIndex++;
  updateGame3QuizLeft();
  if (game3CurrentIndex >= game3Questions.length) {
    endGame3();
  } else {
    loadGame3Question();
  }
}

function updateGame3Score() {
  game3ScoreElem.textContent = `Score: ${game3Score}/6`;
}

function updateGame3QuizLeft() {
  const left = game3Questions.length - game3CurrentIndex;
  game3QuizLeftElem.textContent = left;
}



function endGame3() {
  clearInterval(game3Timer);

  const score = game3Score; // current game score
  const total = game3Questions.length;
  const finalScoreEl = game3FinalScoreElem; // element showing current score
  const highScoreEl = game3FinalHighElem;   // element showing high score

  // Load previous high score
  let highScore = parseInt(localStorage.getItem("game3HighScore")) || 0;

  // Update final score display (X/Y)
  finalScoreEl.textContent = `${score}/${total}`;

  // Update high score if current score is higher
  if (score > highScore) {
    highScore = score;
    localStorage.setItem("game3HighScore", highScore);
  }

  // Update high score display (X/Y)
  highScoreEl.textContent = `${highScore}/${total}`;

  // Update result text
  game3ResultElem.textContent = `You answered ${score}/${total} correctly`;

  // Hide question and options
  document.getElementById("question").style.display = "none";
  document.getElementById("options").style.display = "none";

  // Show game over screen
  showGame3Over();

  // Send high score in plain number to parent
  window.parent.postMessage({
    type: "highscore",
    game: 3, // child game 3
    highscore: highScore
  }, "*");
}


function showGame3Over() {
  document.getElementById("gameOver3").style.display = "block";
document.getElementById('overlay').classList.remove('hidden');
}

function hideGame3Over() {
  document.getElementById("gameOver3").style.display = "none";
document.getElementById('overlay').classList.add('hidden');
 
}





/* Show tutorial at load */
window.onload = () => { 
  // Show tutorial
  document.getElementById("tutorial3").style.display = "block"; 

  // Load retries from localStorage
  const savedRetries = parseInt(localStorage.getItem("game3Retries"));
  if (!isNaN(savedRetries)) {
    game3Retries = savedRetries;
  }

  // Update retry display and disable game if needed
  updateGame3RetryLeft();
};

</script>
</body>
</html>
